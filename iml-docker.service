[Unit]
Description=iml-docker
Requires=docker.service
After=docker.service

[Service]
Type=oneshot
RemainAfterExit=yes
StandardError=journal
StandardOutput=journal
WorkingDirectory=/etc/iml-docker
ExecStart=/usr/bin/docker stack deploy -c docker-compose.yml -c docker-compose.overrides.yml iml --resolve-image=never
ExecStop=/usr/bin/docker stack rm iml
ExecStop=/bin/bash -c 'while /usr/bin/docker stack ps iml > /dev/null 2>&1; do sleep 1; done'


[Install]
WantedBy=multi-user.target