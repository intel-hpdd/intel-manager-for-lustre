version: 1
components:
  server:
    states:
      up:
      down:
    actions:
      add:
        input:
          hostlist:
            - string
          auth: string
          user: string
          tags:
            - string
        provisional: true
        state:
          end: up
  client_mount:
    states:
      mounted:
      unmounted:
    actions:
      create:
        input:
          hostlist:
            - string
          mountspec: string
          mountpoint: string
          tags:
            - string
        provisional: true
        state:
          end: mounted
  lnet:
    states:
      up:
      down:
      loaded:
      unloaded:
      configured:
    actions:
      start:
        state:
          start: 
            - down
          end: up
      stop:
        state:
          start: 
            - up
          end: down
      load:
        state:
          start:
            - unloaded
            - up
          end: loaded
      unload:
        state:
          start: 
            - loaded
          end: unloaded
      configure:
        state:
          start: 
            - loaded
          end: configured
        input:
            - string
      export:
        state:
          start: 
            - configured
          end: up
      unconfigure:
        state:
          start: 
            - configured
          end: loaded
      import:
        state:
          end: unloaded
        input: string
  mgt:
    states:
      mounted:
        dependencies:
          - exactly:
              this.lnet: up
      unmounted:
    actions:
      format:
        provisional: true
        input:
          name: String
        state:
          end: unmounted
      mount:
        input:
          name: String,
        state:
          start: 
            - unmounted
          end: mounted
  ost:
    states:
      mounted:
        dependencies:
          - exactly:
              this.lnet: up
      unmounted:
    actions:
      mount:
        input:
          name: String
        state:
          start: 
            - unmounted
          end: mounted
  mdt:
    states:
      mounted:
        dependencies:
          - exactly:
              this.lnet: up
      unmounted:
    actions:
      mount:
        input:
          name: String
        state:
          start: 
            - unmounted
          end: mounted 
  mgt_mdt:
    states:
      mounted:
        dependencies:
          - exactly:
              this.lnet: up
      unmounted:
    actions:
      mount:
        input:
          name: String
        state:
          start: 
            - unmounted
          end: mounted
  filesystem:
    states:
      unavailable:
      started:
          dependencies:
            - or:
                - this.mgt: mounted
                - this.mgt_mdt: mounted
            - all:
                - this.mdt: mounted
            - all:
                - this.ost: mounted
      stopped:
    actions:
      start:
        input:
          name: String
        state:
          start:
            - stopped
            - unavailable
          end: started
      stop:
        input:
          name: String
        state:
          start: 
            - available
          end: stopped
      create:
        input:
          name: string
          mgt_type: string # one of volume, target, combined
          mgt: string
          mdts_volumes:
            - string
          ost_volumes:
            - string
        provisional: true
        state:
          end: stopped
